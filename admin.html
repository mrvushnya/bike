<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 2rem;
    }
    h1, h2 {
      text-align: center;
      color: #333;
    }
    form {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      max-width: 800px;
      margin: 0 auto 2rem auto;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    input, textarea, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
    }
    button {
      background-color: #007bff;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }
    .preview-images img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      margin: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    .product-item {
      background: white;
      padding: 1.5rem;
      margin: 1rem auto;
      border-radius: 8px;
      max-width: 800px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .product-item img {
      max-width: 100px;
      height: auto;
      margin: 5px;
    }
    .actions {
      margin-top: 1rem;
    }
    .actions button {
      width: auto;
      margin-right: 10px;
      padding: 10px 15px;
    }
    small {
      display: block;
      margin-top: -8px;
      margin-bottom: 10px;
      color: #666;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 800px;
      margin: 0 auto 2rem auto;
    }
    .header h1 {
      margin: 0;
    }
    #userInfo {
      display: none;
      align-items: center;
      gap: 10px;
    }
    #userInfo img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    #userInfo button {
      padding: 6px 10px;
      background: #f44336;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #userInfo button:hover {
      background: #c0392b;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h1>
    <div id="userInfo">
      <img src="https://th.bing.com/th/id/OIP.hyaP7bLgD-Tx-GwTuFFzyQHaHa?rs=1&pid=ImgDetMain" alt="Avatar">
      <span id="adminName"></span>
      <button onclick="logout()">–í–∏–π—Ç–∏</button>
    </div>
  </div>

  <div style="text-align:center; margin-bottom: 1rem;">
    <button onclick="showUsers()">üë• –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</button>
    <button onclick="showOrders()">üì¶ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
  </div>

  <div id="data-display" style="max-width:800px; margin:0 auto;"></div>

  <form id="product-form">
    <input type="hidden" id="edit-index">
    <input type="text" id="name" placeholder="–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É" required>
    <input type="text" id="imageMain" placeholder="URL –≥–æ–ª–æ–≤–Ω–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è" required>
    <textarea id="imagesExtra" placeholder="URL —ñ–Ω—à–∏—Ö —Ñ–æ—Ç–æ (—á–µ—Ä–µ–∑ –∫–æ–º—É)"></textarea>
    <small>–ù–∞–ø—Ä–∏–∫–ª–∞–¥: https://img1.jpg, https://img2.jpg</small>
    <div id="extra-preview" class="preview-images"></div>
    <textarea id="description" placeholder="–û–ø–∏—Å" required></textarea>
    <input type="text" id="price" placeholder="–¶—ñ–Ω–∞" required>
    <button type="submit">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–æ–≤–∞—Ä</button>
  </form>

  <h2 style="text-align:center;">–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤</h2>
  <div id="product-list"></div>

  <script>
    const admin = JSON.parse(localStorage.getItem('currentUser'));
    if (admin && admin.username === 'admin') {
      document.getElementById('userInfo').style.display = 'flex';
      document.getElementById('adminName').textContent = admin.username;
    } else {
      window.location.href = 'index.html';
    }

    function logout() {
      localStorage.removeItem('currentUser');
      window.location.href = 'index.html';
    }

    function renderProducts() {
      const list = document.getElementById("product-list");
      list.innerHTML = "";
      const products = JSON.parse(localStorage.getItem("products") || "[]");
      products.forEach((product, index) => {
        const div = document.createElement("div");
        div.className = "product-item";
        div.innerHTML = `
          <h3>${product.name}</h3>
          <p><strong>–¶—ñ–Ω–∞:</strong> ${product.price}</p>
          <img src="${product.image}" alt="${product.name}">
          <div class="description-container">
            <button onclick="toggleDescription(this)">üîΩ –ü–æ–∫–∞–∑–∞—Ç–∏ –æ–ø–∏—Å</button>
            <p class="product-description" style="display: none;"><em>${product.description}</em></p>
          </div>
          <div>
            ${(product.images || []).map(url => `<img src="${url}" alt="–§–æ—Ç–æ">`).join("")}
          </div>
          <div class="actions">
            <button onclick="editProduct(${index})">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
            <button onclick="deleteProduct(${index})">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
          </div>
        `;
        list.appendChild(div);
      });
    }

    function toggleDescription(button) {
      const desc = button.nextElementSibling;
      if (desc.style.display === "none") {
        desc.style.display = "block";
        button.textContent = "üîº –°—Ö–æ–≤–∞—Ç–∏ –æ–ø–∏—Å";
      } else {
        desc.style.display = "none";
        button.textContent = "üîΩ –ü–æ–∫–∞–∑–∞—Ç–∏ –æ–ø–∏—Å";
      }
    }

    function editProduct(index) {
      const products = JSON.parse(localStorage.getItem("products") || "[]");
      const p = products[index];
      document.getElementById("edit-index").value = index;
      document.getElementById("name").value = p.name;
      document.getElementById("imageMain").value = p.image;
      document.getElementById("imagesExtra").value = (p.images || []).join(", ");
      document.getElementById("description").value = p.description;
      document.getElementById("price").value = p.price;
      updatePreview();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function deleteProduct(index) {
      if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä?")) {
        const products = JSON.parse(localStorage.getItem("products") || "[]");
        products.splice(index, 1);
        localStorage.setItem("products", JSON.stringify(products));
        renderProducts();
      }
    }

    function updatePreview() {
      const preview = document.getElementById("extra-preview");
      const urls = document.getElementById("imagesExtra").value.split(',').map(url => url.trim()).filter(Boolean);
      preview.innerHTML = urls.map(url => `<img src="${url}" alt="–ü—Ä–µ–≤ º—é">`).join("");
    }

    document.getElementById("imagesExtra").addEventListener("input", updatePreview);

    document.getElementById("product-form").addEventListener("submit", function(e) {
      e.preventDefault();
      const products = JSON.parse(localStorage.getItem("products") || "[]");
      const index = document.getElementById("edit-index").value;
      const product = {
        id: index !== "" ? products[index].id : Date.now(),
        name: document.getElementById("name").value,
        image: document.getElementById("imageMain").value,
        images: document.getElementById("imagesExtra").value.trim() === "" ? [] :
                document.getElementById("imagesExtra").value.split(',').map(url => url.trim()),
        description: document.getElementById("description").value,
        price: document.getElementById("price").value
      };

      if (index !== "") {
        products[index] = product;
      } else {
        products.push(product);
      }

      localStorage.setItem("products", JSON.stringify(products));
      this.reset();
      document.getElementById("edit-index").value = "";
      document.getElementById("extra-preview").innerHTML = "";
      renderProducts();
    });

    function showUsers() {
      const users = JSON.parse(localStorage.getItem("users") || "[]");
      const container = document.getElementById("data-display");
      if (users.length === 0) {
        container.innerHTML = "<p>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>";
        return;
      }

      container.innerHTML = "<h2>–°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h2>" + users.map(user => `
        <div style="background:white; padding:1rem; margin:0.5rem 0; border-radius:5px;">
          <strong>–Ü–º'—è:</strong> ${user.username}<br>
          <strong>Email:</strong> ${user.email || "‚Äî"}
        </div>
      `).join("");
    }

   function showOrders() {
    const orders = JSON.parse(localStorage.getItem("orders") || "[]");
    const container = document.getElementById("data-display");

    if (orders.length === 0) {
      container.innerHTML = "<p>–ó–∞–º–æ–≤–ª–µ–Ω—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>";
      return;
    }

    container.innerHTML = "<h2>–°–ø–∏—Å–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å</h2>" + orders.map((order, index) => `
      <div style="background:white; padding:1rem; margin:0.5rem 0; border-radius:5px;">
        <strong>–Ü–º‚Äô—è:</strong> ${order.name} ${order.lastName}<br>
        <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${order.phone}<br>
        <strong>Email:</strong> ${order.email}<br>
        <strong>–¢–æ–≤–∞—Ä:</strong> ${order.product.name} ‚Äî ${order.product.price}<br>
        <strong>–ß–∞—Å:</strong> ${order.timestamp}<br>
        <label>–°—Ç–∞—Ç—É—Å:
          <select onchange="updateOrderStatus(${index}, this.value)">
            <option value="–û—á—ñ–∫—É—î" ${order.status === "–û—á—ñ–∫—É—î" ? "selected" : ""}>–û—á—ñ–∫—É—î</option>
            <option value="–í–∏–∫–æ–Ω–∞–Ω–æ" ${order.status === "–í–∏–∫–æ–Ω–∞–Ω–æ" ? "selected" : ""}>–í–∏–∫–æ–Ω–∞–Ω–æ</option>
            <option value="–°–∫–∞—Å–æ–≤–∞–Ω–æ" ${order.status === "–°–∫–∞—Å–æ–≤–∞–Ω–æ" ? "selected" : ""}>–°–∫–∞—Å–æ–≤–∞–Ω–æ</option>
          </select>
        </label>
      </div>
    `).join("");
  }

  function updateOrderStatus(index, newStatus) {
    const orders = JSON.parse(localStorage.getItem("orders") || "[]");
    if (orders[index]) {
      orders[index].status = newStatus;
      localStorage.setItem("orders", JSON.stringify(orders));
      alert("–°—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª–µ–Ω–æ!");
    }
  }

    renderProducts();
  </script>
</body>
</html>
